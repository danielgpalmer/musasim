# 1 "main.c"
# 1 "/home/daniel/coding/musasim/examples/input//"
# 1 "<command-line>"
# 1 "main.c"
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/lib/gcc/m68k-elf/4.8.1/include/stdbool.h" 1 3 4
# 2 "main.c" 2
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/lib/gcc/m68k-elf/4.8.1/include/stdint.h" 1 3 4
# 9 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/lib/gcc/m68k-elf/4.8.1/include/stdint.h" 3 4
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 1 3 4
# 12 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 3 4
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/_ansi.h" 1 3 4
# 15 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/_ansi.h" 3 4
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/newlib.h" 1 3 4
# 16 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/_ansi.h" 2 3 4
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/sys/config.h" 1 3 4



# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/machine/ieeefp.h" 1 3 4
# 5 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/sys/config.h" 2 3 4
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/sys/features.h" 1 3 4
# 6 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/sys/config.h" 2 3 4
# 17 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/_ansi.h" 2 3 4
# 13 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 2 3 4
# 41 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 3 4
typedef signed char int8_t ;
typedef unsigned char uint8_t ;




typedef signed char int_least8_t;
typedef unsigned char uint_least8_t;




typedef signed short int16_t;
typedef unsigned short uint16_t;
# 67 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 3 4
typedef int16_t int_least16_t;
typedef uint16_t uint_least16_t;
# 79 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 3 4
typedef signed long int32_t;
typedef unsigned long uint32_t;
# 97 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 3 4
typedef int32_t int_least32_t;
typedef uint32_t uint_least32_t;
# 119 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 3 4
typedef signed long long int64_t;
typedef unsigned long long uint64_t;
# 129 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 3 4
typedef int64_t int_least64_t;
typedef uint64_t uint_least64_t;
# 159 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 3 4
  typedef signed int int_fast8_t;
  typedef unsigned int uint_fast8_t;




  typedef signed int int_fast16_t;
  typedef unsigned int uint_fast16_t;




  typedef signed int int_fast32_t;
  typedef unsigned int uint_fast32_t;
# 213 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 3 4
  typedef int_least64_t int_fast64_t;
  typedef uint_least64_t uint_fast64_t;







  typedef long long int intmax_t;
# 231 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 3 4
  typedef long long unsigned int uintmax_t;
# 243 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/stdint.h" 3 4
typedef signed long int intptr_t;
typedef unsigned long int uintptr_t;
# 10 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/lib/gcc/m68k-elf/4.8.1/include/stdint.h" 2 3 4
# 3 "main.c" 2
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/input_registers.h" 1 3
# 4 "main.c" 2
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/input_registermasks.h" 1 3
# 5 "main.c" 2
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/video.h" 1 3
# 13 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/video.h" 3
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/math.h" 1 3
# 11 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/math.h" 3
typedef struct {
 int x1;
 int y1;
 int x2;
 int y2;
} vector;
# 14 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/video.h" 2 3


typedef void (*dataloader)(void* data, uint16_t* buff, int wanted);





void video_begin(void);





void video_commit(void);





void video_flip(void);





void video_blitimage(int width, int height, int x, int y, void* data, dataloader);




void video_blitimage_nocopy(int width, int height, int x, int y, uint16_t* data);
void video_gputs(char* string, uint8_t* font, int col, int row);





void video_clear(uint16_t clearcolour);

void video_fillrect(int x, int y, int width, int height, uint16_t colour);
void video_drawline(vector* v);

void video_setconfig(_Bool vblankint, _Bool hblankint);
void video_waitforvblank();
# 6 "main.c" 2
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/rect.h" 1 3
# 13 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/rect.h" 3
typedef struct {
 int x;
 int y;
 int width;
 int height;
} rect;

void rect_drawrect(rect* r, uint16_t colour);
# 7 "main.c" 2
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/utils.h" 1 3
# 11 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/utils.h" 3
# 1 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/pff.h" 1 3
# 69 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/pff.h" 3
typedef struct {
 uint8_t fs_type;
 uint8_t flag;
 uint8_t csize;
 uint8_t pad1;
 uint16_t n_rootdir;
 uint32_t n_fatent;
 uint32_t fatbase;
 uint32_t dirbase;
 uint32_t database;
 uint32_t fptr;
 uint32_t fsize;
 uint32_t org_clust;
 uint32_t curr_clust;
 uint32_t dsect;
} FATFS;



typedef struct {
 uint16_t index;
 uint8_t* fn;
 uint32_t sclust;
 uint32_t clust;
 uint32_t sect;
} DIR;



typedef struct {
 uint32_t fsize;
 uint16_t fdate;
 uint16_t ftime;
 uint8_t fattrib;
 char fname[13];
} FILINFO;



typedef enum {
 FR_OK = 0,
 FR_DISK_ERR,
 FR_NOT_READY,
 FR_NO_FILE,
 FR_NO_PATH,
 FR_NOT_OPENED,
 FR_NOT_ENABLED,
 FR_NO_FILESYSTEM
} FRESULT;




FRESULT pf_mount(FATFS*);
FRESULT pf_open(const char*);
FRESULT pf_read(void*, uint16_t, uint16_t*);
FRESULT pf_write(const void*, uint16_t, uint16_t*);
FRESULT pf_lseek( uint32_t);
FRESULT pf_opendir(DIR*, const char*);
FRESULT pf_readdir(DIR*, FILINFO*);
# 12 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/utils.h" 2 3
# 21 "/home/daniel/coding/musasim/toolchains/inst/m68k-elf/m68k-elf/include/libunagipai/utils.h" 3
void util_hexblockprint(void* buffer, unsigned len);
void util_printfat(FATFS* fs);
void util_printffresult(FRESULT result);
# 8 "main.c" 2






static rect p0[] = { { 100, 100, 20, 20 },
  { 65, 100, 20, 20 },
  { 40, 100, 20, 20 },
  { 50, 40, 20, 20 },
  { 75, 40, 20, 20 },
  { 90, 40, 20, 20 },
  { 110, 40, 20, 20 },
  { 135, 40, 20, 20 }
};

static rect p1[] = { { 10, 10, 50, 50 },
  { 10, 10, 50, 50 },
  { 10, 10, 50, 50 },
  { 10, 10, 50, 50 },
  { 10, 10, 50, 50 },
  { 10, 10, 50, 50 },
  { 10, 10, 50, 50 },
  { 10, 10, 50, 50 }
};

static uint8_t port0 = 0xff;
static uint8_t port1 = 0xff;

static void update() {
 video_begin();

 for (int r = 0; r < (sizeof(p0)/sizeof(p0[0])); r++) {
  rect_drawrect(&p0[r], (((port0 >> r) & 1) == 0) ? 0xf800 : 0xffff);
 }

 for (int r = 0; r < (sizeof(p1)/sizeof(p1[0])); r++) {
  rect_drawrect(&p1[r], (((port1 >> r) & 1) == 0) ? 0xf800 : 0xffff);
 }

 video_commit();
}

void main() {

 printf("Starting input test\n");
 video_waitforvblank();
 video_setconfig(0, 0);

 update();
 video_waitforvblank();
 video_flip();

 while (1) {
  uint8_t newport0 = (*(volatile uint8_t*) 0xe00000);
  uint8_t newport1 = (*(volatile uint8_t*) 0xe00002);
  if ((port0 != newport0) || (port1 != newport1)) {
   port0 = newport0;
   port1 = newport1;
   update();
   video_waitforvblank();
   video_flip();
  }
  else {
   video_waitforvblank();
  }
 }
}
